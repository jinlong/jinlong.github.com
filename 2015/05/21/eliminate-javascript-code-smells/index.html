
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>去除 JavaScript 代码的怪味 | Alon&#39;s Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Alon Zhang">
    
    <meta name="description" content="原文：《ELIMINATE JAVASCRIPT CODE SMELLS》作者：@elijahmanor笔记：涂鸦码农

难闻的代码
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31">
    
    
    
    
    <link rel="alternative" href="atom.xml" title="Alon&#39;s Blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Alon&#39;s Blog">Alon&#39;s Blog</a></h1>
				<h2 class="blog-motto">一边翻译一边学习---涂鸦码龙</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="http://jinlongz.lofter.com/">涂鸦志</a></li>
					
						<li><a href="/doT">doT文档</a></li>
					
						<li><a href="/archives">存档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:jinlong.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/05/21/eliminate-javascript-code-smells/" title="去除 JavaScript 代码的怪味" itemprop="url">去除 JavaScript 代码的怪味</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://jinlong.github.io" title="Alon Zhang">Alon Zhang</a>
    </p>
  <p class="article-time">
    <time datetime="2015-05-21T15:06:21.000Z" itemprop="datePublished">5月 21 2015</time>
    更新日期:<time datetime="2015-05-21T17:06:04.000Z" itemprop="dateModified">5月 22 2015</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="# 难闻的代码 "><span class="toc-number">1.</span> <span class="toc-text">难闻的代码</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？"><span class="toc-number">1.1.</span> <span class="toc-text">为毛是这个味？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 很多原因："><span class="toc-number">1.2.</span> <span class="toc-text">很多原因：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 检查工具 "><span class="toc-number">1.3.</span> <span class="toc-text">检查工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 重构 "><span class="toc-number">1.4.</span> <span class="toc-text">重构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 "><span class="toc-number">1.5.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 复制粘贴代码的味道 "><span class="toc-number">2.</span> <span class="toc-text">复制粘贴代码的味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 "><span class="toc-number">2.1.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 怎么能不被发现？重构 "><span class="toc-number">2.2.</span> <span class="toc-text">怎么能不被发现？重构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -1"><span class="toc-number">2.3.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#switch_ 味道 "><span class="toc-number">3.</span> <span class="toc-text">switch 味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -1"><span class="toc-number">3.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？违背“打开 / 关闭原则”"><span class="toc-number">3.2.</span> <span class="toc-text">”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 还有其它的味道吗？神奇的字符串 "><span class="toc-number">3.3.</span> <span class="toc-text">还有其它的味道吗？神奇的字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具！？！"><span class="toc-number">3.4.</span> <span class="toc-text">工具！？！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -2"><span class="toc-number">3.5.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#this_ 深渊的味道 "><span class="toc-number">4.</span> <span class="toc-text">this 深渊的味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -2"><span class="toc-number">4.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为什么是这个味？that_ 还是 _self_ 还是 _selfie"><span class="toc-number">4.2.</span> <span class="toc-text">为什么是这个味？that 还是 self 还是 selfie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -1"><span class="toc-number">4.3.</span> <span class="toc-text">工具</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 字符串连接的味道 "><span class="toc-number">5.</span> <span class="toc-text">字符串连接的味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -3"><span class="toc-number">5.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？因为字符串连接 "><span class="toc-number">5.2.</span> <span class="toc-text">为毛是这个味？因为字符串连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -2"><span class="toc-number">5.3.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -3"><span class="toc-number">5.4.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#jQuery_ 调查 "><span class="toc-number">6.</span> <span class="toc-text">jQuery 调查</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -4"><span class="toc-number">6.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？丧心病狂的链式调用 "><span class="toc-number">6.2.</span> <span class="toc-text">为毛是这个味？丧心病狂的链式调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -3"><span class="toc-number">6.3.</span> <span class="toc-text">工具</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 难以琢磨的计时器 "><span class="toc-number">7.</span> <span class="toc-text">难以琢磨的计时器</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -5"><span class="toc-number">7.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛这个味？无法同步的计时器 "><span class="toc-number">7.2.</span> <span class="toc-text">为毛这个味？无法同步的计时器</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 重复定义 "><span class="toc-number">8.</span> <span class="toc-text">重复定义</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -6"><span class="toc-number">8.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -4"><span class="toc-number">8.2.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -4"><span class="toc-number">8.3.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 过度耦合 "><span class="toc-number">9.</span> <span class="toc-text">过度耦合</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -7"><span class="toc-number">9.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？紧密耦合的依赖关系 "><span class="toc-number">9.2.</span> <span class="toc-text">为毛是这个味？紧密耦合的依赖关系</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 连续不断的交互 "><span class="toc-number">10.</span> <span class="toc-text">连续不断的交互</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -8"><span class="toc-number">10.1.</span> <span class="toc-text">难闻的代码</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 匿名函数 "><span class="toc-number">11.</span> <span class="toc-text">匿名函数</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -9"><span class="toc-number">11.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -5"><span class="toc-number">11.2.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 结尾 "><span class="toc-number">12.</span> <span class="toc-text">结尾</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -6"><span class="toc-number">12.1.</span> <span class="toc-text">资源</span></a></li></ol>
		</div>
		
		<blockquote>
<p>原文：《<a href="http://elijahmanor.github.io/talks/js-smells/#/" target="_blank">ELIMINATE JAVASCRIPT CODE SMELLS</a>》<br>作者：<a href="http://elijahmanor.com" target="_blank">@elijahmanor</a><br>笔记：<a href="http://weibo.com/newwave" target="_blank">涂鸦码农</a></p>
</blockquote>
<h1 id=" 难闻的代码 ">难闻的代码</h1>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="code"><pre><span class="comment">/* const */</span> <span class="keyword">var</span> CONSONANTS = <span class="string">'bcdfghjklmnpqrstvwxyz'</span>;
<span class="comment">/* const */</span> <span class="keyword">var</span> VOWELS = <span class="string">'aeiou'</span>;

<span class="function"><span class="keyword">function</span> <span class="title">englishToPigLatin</span><span class="params">(english)</span> {</span>
  <span class="comment">/* const */</span> <span class="keyword">var</span> SYLLABLE = <span class="string">'ay'</span>;
  <span class="keyword">var</span> pigLatin = <span class="string">''</span>;

  <span class="keyword">if</span> (english !== <span class="literal">null</span> && english.length &gt; <span class="number">0</span> &&
    (VOWELS.indexOf(english[<span class="number">0</span>]) &gt; -<span class="number">1</span> ||
    CONSONANTS.indexOf(english[<span class="number">0</span>]) &gt; -<span class="number">1</span> )) {
    <span class="keyword">if</span> (VOWELS.indexOf(english[<span class="number">0</span>]) &gt; -<span class="number">1</span>) {
      pigLatin = english + SYLLABLE;
    } <span class="keyword">else</span> {
      <span class="keyword">var</span> preConsonants = <span class="string">''</span>;
      <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; english.length; ++i) {
        <span class="keyword">if</span> (CONSONANTS.indexOf(english[i]) &gt; -<span class="number">1</span>) {
          preConsonants += english[i];
          <span class="keyword">if</span> (preConsonants == <span class="string">'q'</span> &&
            i+<span class="number">1</span> &lt; english.length && english[i+<span class="number">1</span>] == <span class="string">'u'</span>) {
            preConsonants += <span class="string">'u'</span>;
            i += <span class="number">2</span>;
            <span class="keyword">break</span>;
          }
        } <span class="keyword">else</span> { <span class="keyword">break</span>; }
      }
      pigLatin = english.substring(i) + preConsonants + SYLLABLE;
    }
  }

  <span class="keyword">return</span> pigLatin;
}
</pre></td></tr></table></figure>

<h2 id=" 为毛是这个味？">为毛是这个味？</h2>
<h2 id=" 很多原因：">很多原因：</h2>
<ul>
<li>声明过多</li>
<li>嵌套太深</li>
<li>复杂度太高</li>
</ul>
<h2 id=" 检查工具 ">检查工具</h2>
<p><strong>Lint 规则</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre><span class="comment">/*jshint maxstatements:15, maxdepth:2, maxcomplexity:5 */</span>
<span class="comment">/*jshint 最多声明:15, 最大深度:2, 最高复杂度:5*/</span>

<span class="comment">/*eslint max-statements:[2, 15], max-depth:[1, 2], complexity:[2, 5] */</span>
</pre></td></tr></table></figure>

<p><strong>结果</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="number">7</span>:<span class="number">0</span> - <span class="built_in">Function</span> <span class="string">'englishToPigLatin'</span> has a complexity of <span class="number">7.</span>
<span class="comment">//englishToPigLatin 方法复杂度为 7</span>
<span class="number">7</span>:<span class="number">0</span> - This <span class="function"><span class="keyword">function</span> <span class="title">has</span> <span class="title">too</span> <span class="title">many</span> <span class="title">statements</span> <span class="params">(16)</span>. <span class="title">Maximum</span> <span class="title">allowed</span> <span class="title">is</span> 15.
// 次方法有太多声明<span class="params">(16)</span>。最大允许值为 15。
22:10 - <span class="title">Blocks</span> <span class="title">are</span> <span class="title">nested</span> <span class="title">too</span> <span class="title">deeply</span> <span class="params">(5)</span>.
// 嵌套太深<span class="params">(5)</span></span>
</pre></td></tr></table></figure>

<h2 id=" 重构 ">重构</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre>const CONSONANTS = ['th', 'qu', 'b', 'c', 'd', 'f', 'g', 'h', 'j', 'k',
'l', 'm', 'n', 'p', 'q', 'r', 's', 't', 'v', 'w', 'x', 'y', 'z'];
const VOWELS = ['a', 'e', 'i', 'o', 'u'];
const ENDING = 'ay';

let isValid = word =&gt; startsWithVowel(word) || startsWithConsonant(word);
let startsWithVowel = word =&gt; !!~VOWELS.indexOf(word[0]);
let startsWithConsonant = word =&gt; !!~CONSONANTS.indexOf(word[0]);
let getConsonants = word =&gt; CONSONANTS.reduce((memo, char) =&gt; {
  if (word.startsWith(char)) {
    memo += char;
    word = word.substr(char.length);
  }
  return memo;
}, '');

function englishToPigLatin(english='') {
   if (isValid(english)) {
      if (startsWithVowel(english)) {
        english += ENDING;
      } else {
        let letters = getConsonants(english);
        english = `${english.substr(letters.length)}${letters}${ENDING}`;
      }
   }
   return english;
}
</pre></td></tr></table></figure>

<p><strong>重构后统计</strong></p>
<ul>
<li>max-statements（最多声明）: 16 → 6</li>
<li>max-depth（最大嵌套）: 5 → 2</li>
<li>complexity（复杂度）: 7 → 3</li>
<li>max-len（最多行数）: 65 → 73</li>
<li>max-params（最多参数）: 1 → 2</li>
<li>max-nested-callbacks（最多嵌套回调）: 0 → 1</li>
</ul>
<h2 id=" 资源 ">资源</h2>
<p>jshint - <a href="jshint - http://jshint.com/">http://jshint.com/</a><br>eslint - <a href="http://eslint.org/" target="_blank">http://eslint.org/</a><br>jscomplexity - <a href="http://jscomplexity.org/" target="_blank">http://jscomplexity.org/</a><br>escomplex - <a href="https://github.com/philbooth/escomplex" target="_blank">https://github.com/philbooth/escomplex</a><br>jasmine - <a href="http://jasmine.github.io/" target="_blank">http://jasmine.github.io/</a> </p>
<h1 id=" 复制粘贴代码的味道 ">复制粘贴代码的味道</h1>
<p>已有功能…</p>
<p><img src="/image/js-smell/copy-paste-code-box-crop.png" /></p>
<p>已有代码，BOX.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="comment">// ... more code ...</span>

<span class="keyword">var</span> boxes = document.querySelectorAll(<span class="string">'.Box'</span>);

[].forEach.call(boxes, <span class="function"><span class="keyword">function</span><span class="params">(element, index)</span> {</span>
  element.innerText = <span class="string">"Box: "</span> + index;
  element.style.backgroundColor =
    <span class="string">'#'</span> + (<span class="built_in">Math</span>.random() * <span class="number">0xFFFFFF</span> &lt;&lt; <span class="number">0</span>).toString(<span class="number">16</span>);
});

<span class="comment">// ... more code ...</span>
</pre></td></tr></table></figure>

<p>那么，现在想要这个功能</p>
<p><img src="/image/js-smell/copy-paste-code-circle-crop.png" /></p>
<p>于是，Duang!  CIRCLE.JS 就出现了…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre><span class="comment">// ... more code ...</span>

<span class="keyword">var</span> circles = document.querySelectorAll(<span class="string">".Circle"</span>);

[].forEach.call(circles, <span class="function"><span class="keyword">function</span><span class="params">(element, index)</span> {</span>
  element.innerText = <span class="string">"Circle: "</span> + index;
  element.style.color =
    <span class="string">'#'</span> + (<span class="built_in">Math</span>.random() * <span class="number">0xFFFFFF</span> &lt;&lt; <span class="number">0</span>).toString(<span class="number">16</span>);
});

<span class="comment">// ... more code ...</span>
</pre></td></tr></table></figure>

<p>为毛是这个味？因为我们复制粘贴了！</p>
<h2 id=" 工具 ">工具</h2>
<p><a href="https://github.com/danielstjules/jsinspect" target="_blank">JSINSPECT</a></p>
<p>检查复制粘贴和结构相似的代码</p>
<p>一行命令：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jsinspect
</pre></td></tr></table></figure>

<p><img src="/image/js-smell/jsinspect.png" /></p>
<p><a href="https://github.com/kucherenko/jscpd" target="_blank">JSCPD</a></p>
<p>程序源码的复制 / 粘贴检查器</p>
<p>(JavaScript, TypeScript, C#, Ruby, CSS, SCSS, HTML, 等等都适用…)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>jscpd <span class="operator">-f</span> **/*.js <span class="operator">-l</span> <span class="number">1</span> -t <span class="number">30</span> --languages javascript
</pre></td></tr></table></figure>

<p><img src="/image/js-smell/jscpd.png" /></p>
<h2 id=" 怎么能不被发现？重构 ">怎么能不被发现？重构</h2>
<p>把随机颜色部分丢出去…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">let</span> randomColor = () =&gt; `#${(<span class="built_in">Math</span>.random() * <span class="number">0xFFFFFF</span> &lt;&lt; <span class="number">0</span>).toString(<span class="number">16</span>)};

<span class="keyword">let</span> boxes = document.querySelectorAll(<span class="string">".Box"</span>);
[].forEach.call(boxes, (element, index) =&gt; {
  element.innerText = <span class="string">"Box: "</span> + index;
  element.style.backgroundColor = randomColor();
});

<span class="keyword">let</span> circles = document.querySelectorAll(<span class="string">".Circle"</span>);
[].forEach.call(circles, (element, index) =&gt; {
  element.innerText = <span class="string">"Circle: "</span> + index;
  element.style.color = randomColor();
});
</pre></td></tr></table></figure>

<p>再重构</p>
<p>再把怪异的 [].forEach.call 部分丢出去…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="code"><pre><span class="keyword">let</span> randomColor = () =&gt; `#${(<span class="built_in">Math</span>.random() * <span class="number">0xFFFFFF</span> &lt;&lt; <span class="number">0</span>).toString(<span class="number">16</span>)};

<span class="keyword">let</span> $$ = selector =&gt; [].slice.call(document.querySelectorAll(selector || <span class="string">'*'</span>));

$$(<span class="string">'.Box'</span>).forEach((element, index) =&gt; {
  element.innerText = <span class="string">"Box: "</span> + index;
  element.style.backgroundColor = randomColor();
});

$$(<span class="string">".Circle"</span>).forEach((element, index) =&gt; {
  element.innerText = <span class="string">"Circle: "</span> + index;
  element.style.color = randomColor();
});
</pre></td></tr></table></figure>

<p>再再重构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="keyword">let</span> randomColor = () =&gt; `#${(<span class="built_in">Math</span>.random() * <span class="number">0xFFFFFF</span> &lt;&lt; <span class="number">0</span>).toString(<span class="number">16</span>)};

<span class="keyword">let</span> $$ = selector =&gt; [].slice.call(document.querySelectorAll(selector || <span class="string">'*'</span>));

<span class="keyword">let</span> updateElement = (selector, textPrefix, styleProperty) =&gt; {
  $$(selector).forEach((element, index) =&gt; {
    element.innerText = textPrefix + <span class="string">': '</span> + index;
    element.style[styleProperty] = randomColor();
  });
}

updateElement(<span class="string">'.Box'</span>, <span class="string">'Box'</span>, <span class="string">'backgroundColor'</span>);

updateElement(<span class="string">'.Circle'</span>, <span class="string">'Circle'</span>, <span class="string">'color'</span>);
</pre></td></tr></table></figure>

<h2 id=" 资源 -1">资源</h2>
<ul>
<li><a href="https://github.com/danielstjules" target="_blank">jsinspect</a>  </li>
<li><a href="https://github.com/kucherenko/jscpd" target="_blank">jscpd</a>  </li>
<li><a href="http://codepen.io/elijahmanor/pen/myQebo" target="_blank">CodePen</a> </li>
</ul>
<h1 id="switch_ 味道 ">switch 味道</h1>
<h2 id=" 难闻的代码 -1">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">(shape, options)</span> {</span>
  <span class="keyword">var</span> area = <span class="number">0</span>;

  <span class="keyword">switch</span> (shape) {
    <span class="keyword">case</span> <span class="string">'Triangle'</span>:
      area = <span class="number">.5</span> * options.width * options.height;
      <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="string">'Square'</span>:
      area = <span class="built_in">Math</span>.pow(options.width, <span class="number">2</span>);
      <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="string">'Rectangle'</span>:
      area = options.width * options.height;
      <span class="keyword">break</span>;

    <span class="keyword">default</span>:
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid shape: '</span> + shape);
  }

  <span class="keyword">return</span> area;
}

getArea(<span class="string">'Triangle'</span>,  { width: <span class="number">100</span>, height: <span class="number">100</span> });
getArea(<span class="string">'Square'</span>,    { width: <span class="number">100</span> });
getArea(<span class="string">'Rectangle'</span>, { width: <span class="number">100</span>, height: <span class="number">100</span> });
getArea(<span class="string">'Bogus'</span>);
</pre></td></tr></table></figure>

<h2 id=" 为毛是这个味？违背“打开 / 关闭原则”">为毛是这个味？违背“<a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design" target="_blank">打开 / 关闭原则</a>”</h2>
<p>增加个新形状</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">(shape, options)</span> {</span>
  <span class="keyword">var</span> area = <span class="number">0</span>;

  <span class="keyword">switch</span> (shape) {
    <span class="keyword">case</span> <span class="string">'Triangle'</span>:
      area = <span class="number">.5</span> * options.width * options.height;
      <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="string">'Square'</span>:
      area = <span class="built_in">Math</span>.pow(options.width, <span class="number">2</span>);
      <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="string">'Rectangle'</span>:
      area = options.width * options.height;
      <span class="keyword">break</span>;

    <span class="keyword">case</span> <span class="string">'Circle'</span>:
      area = <span class="built_in">Math</span>.PI * <span class="built_in">Math</span>.pow(options.radius, <span class="number">2</span>);
      <span class="keyword">break</span>;

    <span class="keyword">default</span>:
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid shape: '</span> + shape);
  }

  <span class="keyword">return</span> area;
}
</pre></td></tr></table></figure>

<p>加点设计模式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="code"><pre>(<span class="function"><span class="keyword">function</span><span class="params">(shapes)</span> {</span> <span class="comment">// triangle.js</span>
  <span class="keyword">var</span> Triangle = shapes.Triangle = <span class="function"><span class="keyword">function</span><span class="params">(options)</span> {</span>
    <span class="keyword">this</span>.width = options.width;
    <span class="keyword">this</span>.height = options.height;
  };
  Triangle.prototype.getArea = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="number">0.5</span> * <span class="keyword">this</span>.width * <span class="keyword">this</span>.height;
  };  
}(window.shapes = window.shapes || {}));

<span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">(shape, options)</span> {</span>
  <span class="keyword">var</span> Shape = window.shapes[shape], area = <span class="number">0</span>;

  <span class="keyword">if</span> (Shape && <span class="keyword">typeof</span> Shape === <span class="string">'function'</span>) {
    area = <span class="keyword">new</span> Shape(options).getArea();
  } <span class="keyword">else</span> {
    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid shape: '</span> + shape);
  }

  <span class="keyword">return</span> area;
}

getArea(<span class="string">'Triangle'</span>,  { width: <span class="number">100</span>, height: <span class="number">100</span> });
getArea(<span class="string">'Square'</span>,    { width: <span class="number">100</span> });
getArea(<span class="string">'Rectangle'</span>, { width: <span class="number">100</span>, height: <span class="number">100</span> });
getArea(<span class="string">'Bogus'</span>);
</pre></td></tr></table></figure>

<p>再增加新形状时</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="comment">// circle.js</span>
(<span class="function"><span class="keyword">function</span><span class="params">(shapes)</span> {</span>
  <span class="keyword">var</span> Circle = shapes.Circle = <span class="function"><span class="keyword">function</span><span class="params">(options)</span> {</span>
    <span class="keyword">this</span>.radius = options.radius;
  };

  Circle.prototype.getArea = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="built_in">Math</span>.PI * <span class="built_in">Math</span>.pow(<span class="keyword">this</span>.radius, <span class="number">2</span>);
  };

  Circle.prototype.getCircumference = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="number">2</span> * <span class="built_in">Math</span>.PI * <span class="keyword">this</span>.radius;
  };
}(window.shapes = window.shapes || {}));
</pre></td></tr></table></figure>

<h2 id=" 还有其它的味道吗？神奇的字符串 ">还有其它的味道吗？神奇的字符串</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">(shape, options)</span> {</span>
  <span class="keyword">var</span> area = <span class="number">0</span>;

  <span class="keyword">switch</span> (shape) {
    <span class="keyword">case</span> <span class="string">'Triangle'</span>:
      area = <span class="number">.5</span> * options.width * options.height;
      <span class="keyword">break</span>;
    <span class="comment">/* ... more code ... */</span>
  }

  <span class="keyword">return</span> area;
}

getArea(<span class="string">'Triangle'</span>, { width: <span class="number">100</span>, height: <span class="number">100</span> });
</pre></td></tr></table></figure>

<p>神奇的字符串重构为对象类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="keyword">var</span> shapeType = {
  triangle: <span class="string">'Triangle'</span>
};

<span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">(shape, options)</span> {</span>
  <span class="keyword">var</span> area = <span class="number">0</span>;
  <span class="keyword">switch</span> (shape) {
    <span class="keyword">case</span> shapeType.triangle:
      area = <span class="number">.5</span> * options.width * options.height;
      <span class="keyword">break</span>;
  }
  <span class="keyword">return</span> area;
}

getArea(shapeType.triangle, { width: <span class="number">100</span>, height: <span class="number">100</span> });
</pre></td></tr></table></figure>

<p>神奇字符重构为 CONST &amp; SYMBOLS</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="keyword">const</span> shapeType = {
  triangle: <span class="keyword">new</span> Symbol()
};

<span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">(shape, options)</span> {</span>
  <span class="keyword">var</span> area = <span class="number">0</span>;
  <span class="keyword">switch</span> (shape) {
    <span class="keyword">case</span> shapeType.triangle:
      area = <span class="number">.5</span> * options.width * options.height;
      <span class="keyword">break</span>;
  }
  <span class="keyword">return</span> area;
}

getArea(shapeType.triangle, { width: <span class="number">100</span>, height: <span class="number">100</span> });
</pre></td></tr></table></figure>

<h2 id=" 工具！？！">工具！？！</h2>
<p>木有 :(</p>
<p><a href="http://bit.ly/eslint-plugin-smells" target="_blank">ESLINT-PLUGIN-SMELLS</a><br>用于 JavaScript Smells（味道） 的 ESLint 规则</p>
<p>规则</p>
<ul>
<li>no-switch - 不允许使用  switch  声明</li>
<li>no-complex-switch-case -  不允许使用复杂的  switch  声明</li>
</ul>
<h2 id=" 资源 -2">资源</h2>
<ul>
<li><a href="http://codepen.io/elijahmanor/pen/OPazmm" target="_blank">CodePen</a>  </li>
<li><a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/" target="_blank">Addy Osmani’s JavaScript Design Patterns eBook</a>  </li>
<li><a href="http://eslint.org/" target="_blank">ESLint</a>  </li>
<li><a href="https://github.com/elijahmanor/eslint-plugin-smells" target="_blank">eslint-plugin-smells</a>  </li>
<li><a href="http://www.2ality.com/2015/02/es6-scoping.html" target="_blank">ES6 Scoping</a>  </li>
<li><a href="http://www.2ality.com/2014/12/es6-symbols.html" target="_blank">ES6 Symbols</a>  </li>
<li><a href="http://babeljs.io/docs/learn-es6" target="_blank">Learn ES6</a></li>
</ul>
<h1 id="this_ 深渊的味道 ">this 深渊的味道</h1>
<h2 id=" 难闻的代码 -2">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">Person</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.teeth = [{ clean: <span class="literal">false</span> }, { clean: <span class="literal">false</span> }, { clean: <span class="literal">false</span> }];
};

Person.prototype.brush = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> that = <span class="keyword">this</span>;

  <span class="keyword">this</span>.teeth.forEach(<span class="function"><span class="keyword">function</span><span class="params">(tooth)</span> {</span>
    that.clean(tooth);
  });

  console.log(<span class="string">'brushed'</span>);
};

Person.prototype.clean = <span class="function"><span class="keyword">function</span><span class="params">(tooth)</span> {</span>
  tooth.clean = <span class="literal">true</span>;
}

<span class="keyword">var</span> person = <span class="keyword">new</span> Person();
person.brush();
console.log(person.teeth);
</pre></td></tr></table></figure>

<h2 id=" 为什么是这个味？that_ 还是 _self_ 还是 _selfie">为什么是这个味？that 还是 self 还是 selfie</h2>
<p>替换方案<br>1) bind</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>Person.prototype.brush = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.teeth.forEach(<span class="function"><span class="keyword">function</span><span class="params">(tooth)</span> {</span>
    <span class="keyword">this</span>.clean(tooth);
  }.bind(<span class="keyword">this</span>));

  console.log(<span class="string">'brushed'</span>);
};
</pre></td></tr></table></figure>

<p>替换方案<br>2) forEach 的第二个参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>Person.prototype.brush = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.teeth.forEach(<span class="function"><span class="keyword">function</span><span class="params">(tooth)</span> {</span>
    <span class="keyword">this</span>.clean(tooth);
  }, <span class="keyword">this</span>);

  console.log(<span class="string">'brushed'</span>);
};
</pre></td></tr></table></figure>

<p>替换方案<br>3) ECMAScript 2015 (ES6)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>Person.prototype.brush = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.teeth.forEach(tooth =&gt; {
    <span class="keyword">this</span>.clean(tooth);
  });

  console.log(<span class="string">'brushed'</span>);
};
</pre></td></tr></table></figure>

<p>4a) 函数式编程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>Person.prototype.brush = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.teeth.forEach(<span class="keyword">this</span>.clean);

  console.log(<span class="string">'brushed'</span>);
};
</pre></td></tr></table></figure>

<p>4b) 函数式编程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>Person.prototype.brush = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.teeth.forEach(<span class="keyword">this</span>.clean.bind(<span class="keyword">this</span>));

  console.log(<span class="string">'brushed'</span>);
};
</pre></td></tr></table></figure>

<h2 id=" 工具 -1">工具</h2>
<p>ESLint</p>
<ul>
<li><a href="https://github.com/elijahmanor/eslint-plugin-smells" target="_blank">no-this-assign</a> (eslint-plugin-smells) </li>
<li><a href="http://eslint.org/docs/rules/consistent-this" target="_blank">consistent-this</a> </li>
<li><a href="http://eslint.org/docs/rules/no-extra-bind" target="_blank">no-extra-bind</a></li>
</ul>
<h1 id=" 字符串连接的味道 ">字符串连接的味道</h1>
<h2 id=" 难闻的代码 -3">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">var</span> build = <span class="function"><span class="keyword">function</span><span class="params">(id, href)</span> {</span>
  <span class="keyword">return</span> $( <span class="string">"&lt;div id='tab'&gt;&lt;a href='"</span> + href + <span class="string">"' id='"</span>+ id + <span class="string">"'&gt;&lt;/div&gt;"</span> );
}
</pre></td></tr></table></figure>

<h2 id=" 为毛是这个味？因为字符串连接 ">为毛是这个味？因为字符串连接</h2>
<p>替换方案<br>@thomasfuchs <a href="http://mir.aculo.us/2011/03/09/little-helpers-a-tweet-sized-javascript-templating-engine/" target="_blank">推文上的 JavaScript 模板引擎</a> </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(s, d)</span> {</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> d)
    s = s.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'{'</span> + p + <span class="string">'}'</span>, <span class="string">'g'</span>), d[p]);
  <span class="keyword">return</span> s;
}

<span class="keyword">var</span> build = <span class="function"><span class="keyword">function</span><span class="params">(id, href)</span> {</span>
  <span class="keyword">var</span> options = {
    id: id
    href: href
  };

  <span class="keyword">return</span> t(<span class="string">'&lt;div id="tab"&gt;&lt;a href="{href}" id="{id}"&gt;&lt;/div&gt;'</span>, options);
}
</pre></td></tr></table></figure>

<p>替换方案<br>2) ECMAScript 2015 (ES6) 模板字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="keyword">var</span> build = (id, href) =&gt;
  `&lt;div id=<span class="string">"tab"</span>&gt;<span class="xml"><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"${href}"</span> <span class="attribute">id</span>=<span class="value">"${id}"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>`;</span>
</pre></td></tr></table></figure>

<p>替换方案<br>3) ECMAScript 2015 (ES6)  模板字符串  (多行)</p>
<p>替换方案<br>4) 其它小型库或大型库 / 框架</p>
<ul>
<li>Lowdash 或 Underscore</li>
<li>Angular</li>
<li>React</li>
<li>Ember</li>
<li>等等…</li>
</ul>
<h2 id=" 工具 -2">工具</h2>
<p>ESLINT-PLUGIN-SMELLS<br><a href="http://bit.ly/eslint-plugin-smells" target="_blank">no-complex-string-concat</a> </p>
<h2 id=" 资源 -3">资源</h2>
<p><a href="http://mir.aculo.us/2011/03/09/little-helpers-a-tweet-sized-javascript-templating-engine/" target="_blank">Tweet Sized JavaScript Templating Engine</a> by @thomasfuchs<br>Learn ECMAScript 2015 (ES6) - <a href="http://babeljs.io/docs/learn-es6/" target="_blank">http://babeljs.io/docs/learn-es6/</a></p>
<h1 id="jQuery_ 调查 ">jQuery 调查</h1>
<h2 id=" 难闻的代码 -4">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>$(document).ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  $(<span class="string">'.Component'</span>)
    .find(<span class="string">'button'</span>)
      .addClass(<span class="string">'Component-button--action'</span>)
      .click(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> alert(<span class="string">'HEY!'</span>); })
    .end()
    .mouseenter(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> $(<span class="keyword">this</span>).addClass(<span class="string">'Component--over'</span>); })
    .mouseleave(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> $(<span class="keyword">this</span>).removeClass(<span class="string">'Component--over'</span>); })
    .addClass(<span class="string">'initialized'</span>);
});
</pre></td></tr></table></figure>

<h2 id=" 为毛是这个味？丧心病狂的链式调用 ">为毛是这个味？丧心病狂的链式调用</h2>
<p>愉快地重构吧</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="comment">// Event Delegation before DOM Ready</span>
$(document).on(<span class="string">'mouseenter mouseleave'</span>, <span class="string">'.Component'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  $(<span class="keyword">this</span>).toggleClass(<span class="string">'Component--over'</span>, e.type === <span class="string">'mouseenter'</span>);  
});

$(document).on(<span class="string">'click'</span>, <span class="string">'.Component'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  alert(<span class="string">'HEY!'</span>);
});

$(document).ready(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  $(<span class="string">'.Component button'</span>).addClass(<span class="string">'Component-button--action'</span>);
});
</pre></td></tr></table></figure>

<p>最终 Demo</p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="pvQQZw" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/pvQQZw/'>pvQQZw</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<h2 id=" 工具 -3">工具</h2>
<p>ESLINT-PLUGIN-SMELLS</p>
<ul>
<li><a href="http://bit.ly/eslint-plugin-smells" target="_blank">no-complex-chaining</a> </li>
</ul>
<h1 id=" 难以琢磨的计时器 ">难以琢磨的计时器</h1>
<h2 id=" 难闻的代码 -5">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>setInterval(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  console.log(<span class="string">'start setInterval'</span>);
  someLongProcess(getRandomInt(<span class="number">2000</span>, <span class="number">4000</span>));
}, <span class="number">3000</span>);

<span class="function"><span class="keyword">function</span> <span class="title">someLongProcess</span><span class="params">(duration)</span> {</span>
  setTimeout(
    <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> console.log(<span class="string">'long process: '</span> + duration); },
    duration
  );  
}

<span class="function"><span class="keyword">function</span> <span class="title">getRandomInt</span><span class="params">(min, max)</span> {</span>
  <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min + <span class="number">1</span>)) + min;
}
</pre></td></tr></table></figure>

<h2 id=" 为毛这个味？无法同步的计时器 ">为毛这个味？无法同步的计时器</h2>
<p>Demo: setInterval</p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="bNQmzP" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/bNQmzP/'>bNQmzP</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>用 setTimeout 保证顺序</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre>setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span><span class="params">()</span> {</span>
  console.log(<span class="string">'start setTimeout'</span>)
  someLongProcess(getRandomInt(<span class="number">2000</span>, <span class="number">4000</span>), <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    setTimeout(timer, <span class="number">3000</span>);
  });
}, <span class="number">3000</span>);

<span class="function"><span class="keyword">function</span> <span class="title">someLongProcess</span><span class="params">(duration, callback)</span> {</span>
  setTimeout(<span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    console.log(<span class="string">'long process: '</span> + duration);
    callback();
  }, duration);  
}

<span class="comment">/* getRandomInt(min, max) {} */</span>
</pre></td></tr></table></figure>

<p>Demo: setTimeout </p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="raQQay" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/raQQay/'>raQQay</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<h1 id=" 重复定义 ">重复定义</h1>
<h2 id=" 难闻的代码 -6">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
</pre></td><td class="code"><pre>data = <span class="keyword">this</span>.appendAnalyticsData(data);
data = <span class="keyword">this</span>.appendSubmissionData(data);
data = <span class="keyword">this</span>.appendAdditionalInputs(data);
data = <span class="keyword">this</span>.pruneObject(data);
</pre></td></tr></table></figure>

<p>替换方案<br>1) 嵌套调用函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre>data = <span class="keyword">this</span>.pruneObject(
  <span class="keyword">this</span>.appendAdditionalInputs(
    <span class="keyword">this</span>.appendSubmissionData(
      <span class="keyword">this</span>.appendAnalyticsData(data)
    )
  )
);
</pre></td></tr></table></figure>

<p>2) forEach</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="keyword">var</span> funcs = [
  <span class="keyword">this</span>.appendAnalyticsData,
  <span class="keyword">this</span>.appendSubmissionData,
  <span class="keyword">this</span>.appendAdditionalInputs,
  <span class="keyword">this</span>.pruneObject
];

funcs.forEach(<span class="function"><span class="keyword">function</span><span class="params">(func)</span> {</span>
  data = func(data);
});
</pre></td></tr></table></figure>

<p>3) reduce</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="keyword">var</span> funcs = [
  <span class="keyword">this</span>.appendAnalyticsData,
  <span class="keyword">this</span>.appendSubmissionData,
  <span class="keyword">this</span>.appendAdditionalInputs,
  <span class="keyword">this</span>.pruneObject
];

data = funcs.reduce(<span class="function"><span class="keyword">function</span><span class="params">(memo, func)</span> {</span>
  <span class="keyword">return</span> func(memo);
}, data);
</pre></td></tr></table></figure>

<p>4) <a href="https://lodash.com/docs#flow" target="_blank">flow</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre>data = _.flow(
  <span class="keyword">this</span>.appendAnalyticsData,
  <span class="keyword">this</span>.appendSubmissionData,
  <span class="keyword">this</span>.appendAdditionalInputs,
  <span class="keyword">this</span>.pruneObject
)(data);
</pre></td></tr></table></figure>

<h2 id=" 工具 -4">工具</h2>
<p>ESLINT-PLUGIN-SMELLS</p>
<ul>
<li><a href="http://bit.ly/eslint-plugin-smells" target="_blank">no-reassign</a> </li>
</ul>
<h2 id=" 资源 -4">资源</h2>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/forEach" target="_blank">forEach</a>  </li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank">reduce</a>  </li>
<li><a href="https://lodash.com/docs#flow" target="_blank">_.flow</a> </li>
</ul>
<h1 id=" 过度耦合 ">过度耦合</h1>
<h2 id=" 难闻的代码 -7">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">ShoppingCart</span><span class="params">()</span> {</span> <span class="keyword">this</span>.items = []; }
ShoppingCart.prototype.addItem = <span class="function"><span class="keyword">function</span><span class="params">(item)</span> {</span>
  <span class="keyword">this</span>.items.push(item);
};

<span class="function"><span class="keyword">function</span> <span class="title">Product</span><span class="params">(name)</span> {</span> <span class="keyword">this</span>.name = name; }
Product.prototype.addToCart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  shoppingCart.addItem(<span class="keyword">this</span>);
};

<span class="keyword">var</span> shoppingCart = <span class="keyword">new</span> ShoppingCart();
<span class="keyword">var</span> product = <span class="keyword">new</span> Product(<span class="string">'Socks'</span>);
product.addToCart();
console.log(shoppingCart.items);
</pre></td></tr></table></figure>

<h2 id=" 为毛是这个味？紧密耦合的依赖关系 ">为毛是这个味？紧密耦合的依赖关系</h2>
<p>如何改善！？！</p>
<ol>
<li>依赖注入</li>
<li><p>消息订阅</p>
</li>
<li><p>依赖注入 </p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="code"><pre><span class="function"><span class="keyword">function</span> <span class="title">ShoppingCart</span><span class="params">()</span> {</span> <span class="keyword">this</span>.items = []; }
ShoppingCart.prototype.addItem = <span class="function"><span class="keyword">function</span><span class="params">(item)</span> {</span>
  <span class="keyword">this</span>.items.push(item);
};

<span class="function"><span class="keyword">function</span> <span class="title">Product</span><span class="params">(name, shoppingCart)</span> {</span>
  <span class="keyword">this</span>.name = name;
  <span class="keyword">this</span>.shoppingCart = shoppingCart;
}
Product.prototype.addToCart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.shoppingCart.addItem(<span class="keyword">this</span>);
};

<span class="keyword">var</span> shoppingCart = <span class="keyword">new</span> ShoppingCart();
<span class="keyword">var</span> product = <span class="keyword">new</span> Product(<span class="string">'Socks'</span>, shoppingCart);
product.addToCart();
console.log(shoppingCart.items);
</pre></td></tr></table></figure>

<ol>
<li>消息订阅 </li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="code"><pre><span class="keyword">var</span> channel = postal.channel();

<span class="function"><span class="keyword">function</span> <span class="title">ShoppingCart</span><span class="params">()</span> {</span>
  <span class="keyword">this</span>.items = [];
  channel.subscribe(<span class="string">'shoppingcart.add'</span>, <span class="keyword">this</span>.addItem);
}
ShoppingCart.prototype.addItem = <span class="function"><span class="keyword">function</span><span class="params">(item)</span> {</span>
  <span class="keyword">this</span>.items.push(item);
};

<span class="function"><span class="keyword">function</span> <span class="title">Product</span><span class="params">(name)</span> {</span> <span class="keyword">this</span>.name = name; }
Product.prototype.addToCart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  channel.publish(<span class="string">'shoppingcart.add'</span>, <span class="keyword">this</span>);
};

<span class="keyword">var</span> shoppingCart = <span class="keyword">new</span> ShoppingCart();
<span class="keyword">var</span> product = <span class="keyword">new</span> Product(<span class="string">'Socks'</span>);
product.addToCart();
console.log(shoppingCart.items);
</pre></td></tr></table></figure>

<p>资源</p>
<ul>
<li><a href="https://github.com/postaljs/postal.js" target="_blank">postal</a> by @ifandelse</li>
</ul>
<h1 id=" 连续不断的交互 ">连续不断的交互</h1>
<h2 id=" 难闻的代码 -8">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="keyword">var</span> search = document.querySelector(<span class="string">'.Autocomplete'</span>);

search.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  <span class="comment">// Make Ajax call for autocomplete</span>

  console.log(e.target.value);
});
</pre></td></tr></table></figure>

<p>Demo: 根本停不下来</p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="LEXBdX" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/LEXBdX/'>LEXBdX</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>解决方案：节流阀</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="keyword">var</span> search = document.querySelector(<span class="string">'.Autocomplete'</span>);

search.addEventListener(<span class="string">'input'</span>, _.throttle(<span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  <span class="comment">// Make Ajax call for autocomplete</span>

  console.log(e.target.value);
}, <span class="number">500</span>));
</pre></td></tr></table></figure>

<p>Demo: </p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="azQjGj" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/azQjGj/'>azQjGj</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>解决方案：DEBOUNCE</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="keyword">var</span> search = document.querySelector(<span class="string">'.Autocomplete'</span>);

search.addEventListener(<span class="string">'input'</span>, _.debounce(<span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  <span class="comment">// Make Ajax call for autocomplete</span>

  console.log(e.target.value);
}, <span class="number">500</span>));
</pre></td></tr></table></figure>

<p>Demo</p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="bNQjje" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/bNQjje/'>bNQjje</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<p>资源</p>
<ul>
<li><a href="https://lodash.com/" target="_blank">lodash</a>  </li>
<li><a href="https://lodash.com/docs#throttle" target="_blank">throttle</a> </li>
<li><a href="https://lodash.com/docs#debounce" target="_blank">debounce</a></li>
</ul>
<h1 id=" 匿名函数 ">匿名函数</h1>
<h2 id=" 难闻的代码 -9">难闻的代码</h2>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> search = document.querySelector(<span class="string">'.Autocomplete'</span>);

search.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  console.log(e.target.value);
});
</pre></td></tr></table></figure>

<p>给函数命名的原因：</p>
<ol>
<li>堆栈追踪</li>
<li>去关联</li>
<li><p>代码复用</p>
</li>
<li><p>堆栈追踪</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> search = document.querySelector(<span class="string">'.Autocomplete'</span>);

search.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span><span class="params">(e)</span> {</span>
  console.log(e.target.value);
});
</pre></td></tr></table></figure>

<p><img src="/image/js-smell/06-1-a.png" /></p>
<p>修改后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> search = document.querySelector(<span class="string">'.Autocomplete'</span>);

search.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span> <span class="title">matches</span><span class="params">(e)</span> {</span>
  console.log(e.target.value);
});
</pre></td></tr></table></figure>

<p><img src="/image/js-smell/06-1-b.png" /></p>
<ol>
<li>去关联</li>
</ol>
<p>单次事件绑定</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>document.querySelector(<span class="string">'button'</span>)
  .addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> <span class="title">handler</span><span class="params">()</span> {</span>
      alert(<span class="string">'Ka-boom!'</span>);
    <span class="keyword">this</span>.removeEventListener(<span class="string">'click'</span>, handler);
  });
</pre></td></tr></table></figure>

<p>Demo</p>
<p><p data-height="268" data-theme-id="0" data-slug-hash="PwxBxP" data-default-tab="result" data-user="elijahmanor" class='codepen'>See the Pen <a href='http://codepen.io/elijahmanor/pen/PwxBxP/'>PwxBxP</a> by Elijah Manor (<a href='http://codepen.io/elijahmanor'>@elijahmanor</a>) on <a href='http://codepen.io'>CodePen</a>.</p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<ol>
<li>代码复用</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre><span class="keyword">var</span> kaboom = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> alert(<span class="string">'Ka-boom'</span>); };

document.querySelector(<span class="string">'button'</span>).addEventListener(<span class="string">'click'</span>, kaboom);

document.querySelector(<span class="string">'#egg'</span>).addEventListener(<span class="string">'mouseenter'</span>, kaboom);
</pre></td></tr></table></figure>

<h2 id=" 资源 -5">资源</h2>
<ul>
<li><a href="https://developer.chrome.com/devtools" target="_blank">Chrome DevTools</a> </li>
</ul>
<h1 id=" 结尾 ">结尾</h1>
<p>更多的 ESLint 规则</p>
<ul>
<li><a href="https://www.npmjs.com/package/eslint-plugin-react" target="_blank">eslint-plugin-react</a>  </li>
<li><a href="https://www.npmjs.com/package/eslint-plugin-angular" target="_blank">eslint-plugin-angular</a> </li>
<li><a href="https://www.npmjs.com/package/eslint-plugin-ember" target="_blank">eslint-plugin-ember</a>  </li>
<li><a href="https://www.npmjs.com/package/eslint-plugin-backbone" target="_blank">eslint-plugin-backbone</a> </li>
</ul>
<h2 id=" 资源 -6">资源</h2>
<p>NPM 搜索  <a href="https://www.npmjs.com/search?q=eslint-plugin" target="_blank">eslint-plugin</a>  </p>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a><a href="/tags/ES6/">ES6</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>



<div class="article-share" id="share">

  
<div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_tsina">新浪微博</a>
    <a class="jiathis_button_weixin">微信</a>
    <a class="jiathis_button_twitter">Twitter</a>
    <a class="jiathis_button_evernote">EverNote</a>
    <a href="http://www.jiathis.com/share?uid=1501277" class="jiathis jiathis_txt jiathis_separator jtico jtico_jiathis" target="_blank">更多</a>
</div>
<script type="text/javascript" >
    var jiathis_config={
    data_track_clickback:true,
    sm:"copy,renren,cqq",
    pic:"",
    summary:"",
     ralateuid:{"tsina":"1608907662"},hideMore:false}
    
  </script> 
<script type="text/javascript" src="//v3.jiathis.com/code/jia.js?uid=
1359953759521102" charset="utf-8"></script>      


</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2015/02/01/javascript-errors-and-how-to-fix-them/"  title="JavaScript 错误以及如何修复">
 <strong>NEXT:</strong><br/> 
 <span>JavaScript 错误以及如何修复
</span>
</a>
</div>

</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="# 难闻的代码 "><span class="toc-number">1.</span> <span class="toc-text">难闻的代码</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？"><span class="toc-number">1.1.</span> <span class="toc-text">为毛是这个味？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 很多原因："><span class="toc-number">1.2.</span> <span class="toc-text">很多原因：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 检查工具 "><span class="toc-number">1.3.</span> <span class="toc-text">检查工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 重构 "><span class="toc-number">1.4.</span> <span class="toc-text">重构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 "><span class="toc-number">1.5.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 复制粘贴代码的味道 "><span class="toc-number">2.</span> <span class="toc-text">复制粘贴代码的味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 "><span class="toc-number">2.1.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 怎么能不被发现？重构 "><span class="toc-number">2.2.</span> <span class="toc-text">怎么能不被发现？重构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -1"><span class="toc-number">2.3.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#switch_ 味道 "><span class="toc-number">3.</span> <span class="toc-text">switch 味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -1"><span class="toc-number">3.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？违背“打开 / 关闭原则”"><span class="toc-number">3.2.</span> <span class="toc-text">”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 还有其它的味道吗？神奇的字符串 "><span class="toc-number">3.3.</span> <span class="toc-text">还有其它的味道吗？神奇的字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具！？！"><span class="toc-number">3.4.</span> <span class="toc-text">工具！？！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -2"><span class="toc-number">3.5.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#this_ 深渊的味道 "><span class="toc-number">4.</span> <span class="toc-text">this 深渊的味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -2"><span class="toc-number">4.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为什么是这个味？that_ 还是 _self_ 还是 _selfie"><span class="toc-number">4.2.</span> <span class="toc-text">为什么是这个味？that 还是 self 还是 selfie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -1"><span class="toc-number">4.3.</span> <span class="toc-text">工具</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 字符串连接的味道 "><span class="toc-number">5.</span> <span class="toc-text">字符串连接的味道</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -3"><span class="toc-number">5.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？因为字符串连接 "><span class="toc-number">5.2.</span> <span class="toc-text">为毛是这个味？因为字符串连接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -2"><span class="toc-number">5.3.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -3"><span class="toc-number">5.4.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#jQuery_ 调查 "><span class="toc-number">6.</span> <span class="toc-text">jQuery 调查</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -4"><span class="toc-number">6.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？丧心病狂的链式调用 "><span class="toc-number">6.2.</span> <span class="toc-text">为毛是这个味？丧心病狂的链式调用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -3"><span class="toc-number">6.3.</span> <span class="toc-text">工具</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 难以琢磨的计时器 "><span class="toc-number">7.</span> <span class="toc-text">难以琢磨的计时器</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -5"><span class="toc-number">7.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛这个味？无法同步的计时器 "><span class="toc-number">7.2.</span> <span class="toc-text">为毛这个味？无法同步的计时器</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 重复定义 "><span class="toc-number">8.</span> <span class="toc-text">重复定义</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -6"><span class="toc-number">8.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 工具 -4"><span class="toc-number">8.2.</span> <span class="toc-text">工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -4"><span class="toc-number">8.3.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 过度耦合 "><span class="toc-number">9.</span> <span class="toc-text">过度耦合</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -7"><span class="toc-number">9.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 为毛是这个味？紧密耦合的依赖关系 "><span class="toc-number">9.2.</span> <span class="toc-text">为毛是这个味？紧密耦合的依赖关系</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 连续不断的交互 "><span class="toc-number">10.</span> <span class="toc-text">连续不断的交互</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -8"><span class="toc-number">10.1.</span> <span class="toc-text">难闻的代码</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 匿名函数 "><span class="toc-number">11.</span> <span class="toc-text">匿名函数</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 难闻的代码 -9"><span class="toc-number">11.1.</span> <span class="toc-text">难闻的代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -5"><span class="toc-number">11.2.</span> <span class="toc-text">资源</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="# 结尾 "><span class="toc-number">12.</span> <span class="toc-text">结尾</span></a></li><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="# 资源 -6"><span class="toc-number">12.1.</span> <span class="toc-text">资源</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/AngularJS/" title="AngularJS">AngularJS<sup>4</sup></a></li>
		
			<li><a href="/tags/Blink/" title="Blink">Blink<sup>1</sup></a></li>
		
			<li><a href="/tags/CSS/" title="CSS">CSS<sup>5</sup></a></li>
		
			<li><a href="/tags/CSS3/" title="CSS3">CSS3<sup>1</sup></a></li>
		
			<li><a href="/tags/Chrome Extensions/" title="Chrome Extensions">Chrome Extensions<sup>1</sup></a></li>
		
			<li><a href="/tags/Debug/" title="Debug">Debug<sup>1</sup></a></li>
		
			<li><a href="/tags/ES6/" title="ES6">ES6<sup>1</sup></a></li>
		
			<li><a href="/tags/Express/" title="Express">Express<sup>1</sup></a></li>
		
			<li><a href="/tags/Firebug/" title="Firebug">Firebug<sup>1</sup></a></li>
		
			<li><a href="/tags/Git/" title="Git">Git<sup>1</sup></a></li>
		
			<li><a href="/tags/Github Pages/" title="Github Pages">Github Pages<sup>1</sup></a></li>
		
			<li><a href="/tags/Grunt/" title="Grunt">Grunt<sup>2</sup></a></li>
		
			<li><a href="/tags/HTML5/" title="HTML5">HTML5<sup>1</sup></a></li>
		
			<li><a href="/tags/Handlebars/" title="Handlebars">Handlebars<sup>1</sup></a></li>
		
			<li><a href="/tags/JSHint/" title="JSHint">JSHint<sup>1</sup></a></li>
		
			<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>5</sup></a></li>
		
			<li><a href="/tags/Javascript/" title="Javascript">Javascript<sup>1</sup></a></li>
		
			<li><a href="/tags/Node.js/" title="Node.js">Node.js<sup>4</sup></a></li>
		
			<li><a href="/tags/Octopress/" title="Octopress">Octopress<sup>2</sup></a></li>
		
			<li><a href="/tags/Opera/" title="Opera">Opera<sup>1</sup></a></li>
		
		</ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/AngularJS/" style="font-size: 17.50px;">AngularJS</a><a href="/tags/Blink/" style="font-size: 10.00px;">Blink</a><a href="/tags/CSS/" style="font-size: 20.00px;">CSS</a><a href="/tags/CSS3/" style="font-size: 10.00px;">CSS3</a><a href="/tags/Chrome Extensions/" style="font-size: 10.00px;">Chrome Extensions</a><a href="/tags/Debug/" style="font-size: 10.00px;">Debug</a><a href="/tags/ES6/" style="font-size: 10.00px;">ES6</a><a href="/tags/Express/" style="font-size: 10.00px;">Express</a><a href="/tags/Firebug/" style="font-size: 10.00px;">Firebug</a><a href="/tags/Git/" style="font-size: 10.00px;">Git</a><a href="/tags/Github Pages/" style="font-size: 10.00px;">Github Pages</a><a href="/tags/Grunt/" style="font-size: 12.50px;">Grunt</a><a href="/tags/HTML5/" style="font-size: 10.00px;">HTML5</a><a href="/tags/Handlebars/" style="font-size: 10.00px;">Handlebars</a><a href="/tags/JSHint/" style="font-size: 10.00px;">JSHint</a><a href="/tags/JavaScript/" style="font-size: 20.00px;">JavaScript</a><a href="/tags/Javascript/" style="font-size: 10.00px;">Javascript</a><a href="/tags/Node.js/" style="font-size: 17.50px;">Node.js</a><a href="/tags/Octopress/" style="font-size: 12.50px;">Octopress</a><a href="/tags/Opera/" style="font-size: 10.00px;">Opera</a><a href="/tags/Opera Extensions/" style="font-size: 10.00px;">Opera Extensions</a><a href="/tags/Safari/" style="font-size: 10.00px;">Safari</a><a href="/tags/WebKit/" style="font-size: 10.00px;">WebKit</a><a href="/tags/flexbox/" style="font-size: 10.00px;">flexbox</a><a href="/tags/iOS7/" style="font-size: 10.00px;">iOS7</a><a href="/tags/jQuery/" style="font-size: 10.00px;">jQuery</a><a href="/tags/requestAnimationFrame/" style="font-size: 10.00px;">requestAnimationFrame</a><a href="/tags/toString/" style="font-size: 10.00px;">toString</a><a href="/tags/translate/" style="font-size: 10.00px;">translate</a><a href="/tags/交互设计/" style="font-size: 10.00px;">交互设计</a><a href="/tags/代码高亮/" style="font-size: 10.00px;">代码高亮</a><a href="/tags/全文搜索/" style="font-size: 10.00px;">全文搜索</a><a href="/tags/原创/" style="font-size: 15.00px;">原创</a><a href="/tags/垂直居中/" style="font-size: 10.00px;">垂直居中</a><a href="/tags/居中/" style="font-size: 10.00px;">居中</a><a href="/tags/开发工具/" style="font-size: 10.00px;">开发工具</a><a href="/tags/弹性布局/" style="font-size: 10.00px;">弹性布局</a><a href="/tags/水平居中/" style="font-size: 10.00px;">水平居中</a><a href="/tags/浏览器/" style="font-size: 10.00px;">浏览器</a><a href="/tags/滑动门/" style="font-size: 10.00px;">滑动门</a>
    </div>
  </div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://www.gaiyong.me/" target="_blank">[低调的产品经理] <strong>敏感的胖子</strong></a></li>
      <li><a href="http://www.xcodezone.com/" target="_blank">[PHP架构师] <strong>jiangfeng3</strong></a></li>
      <li><a href="http://www.stylejar.com/" target="_blank">[热衷IOS的 PHP Coder] <strong>c小淡</strong></a></li>
      <li><a href="http://yangjian.me" target="_blank" title="YangJian">Alimon's Blog</a></li>
      <li><a href="http://hexo.io/" target="_blank" title="Hexo">Hexo</a></li>
    </ul>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> Hi~ I&#39;m Alon Zhang, Doodler and Coder <br/>
			忙时码代码，无事乱涂鸦</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/newwave" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/jinlong" target="_blank" title="github"></a>
		
		
	</div>
		<p class="copyright">Powered by <a href="http://zespia.tw/hexo/" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2015 
		
		<a href="http://jinlong.github.io" target="_blank" title="Alon Zhang">Alon Zhang</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"jinlong"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F2bd777ce3d5910b5c44deb753c24f3e3' type='text/javascript'%3E%3C/script%3E"));
</script>


  </body>
</html>
